(function(e,t){"object"===typeof exports&&"undefined"!==typeof module?t(exports,require("san")):"function"===typeof define&&define.amd?define(["exports","san"],t):(e=e||self,t(e.Vusa={},e.san))})(this,(function(e,t){"use strict";var n=t.Data.prototype.get;t.Data.prototype.get=function(e,r){e&&"object"!==typeof e&&(e=t.parseExpr(e));var a=n.call(this,e&&e.paths.length?e:void 0,r);if(!e||void 0!==a||!this.owner||e.type!==t.ExprType.ACCESSOR)return a;var i=e.paths,o=i[0].value;if(this.owner._propKeys.concat(this.owner._dataKeys,this.owner._computedKeys).indexOf(o)>=0)return a;a=this.owner[o];for(var s=1,c=i.length;null!=a&&s<c;s++)a=a[i[s].value||t.evalExpr(i[s],r)];return a};var r=Object.assign;function a(e){for(var t={},n=0;n<e.length;n++)e[n]&&r(t,e[n]);return t}function i(e,t){if(e.length){var n=e.indexOf(t);if(n>-1)return e.splice(n,1)}}var o=Object.prototype.toString;function s(e){return null!==e&&"object"===typeof e}function c(e){return"[object Object]"===o.call(e)}function u(e,t,n){Object.defineProperty(e,t,r({enumerable:!1,configurable:!0},n))}function l(e){var t=Object.create(null);return function(n){var r=t[n];return r||(t[n]=e(n))}}var f=/([^-])([A-Z])/g,p=l((function(e){return e.replace(f,"$1-$2").replace(f,"$1-$2").toLowerCase()})),d=function(e){return e.replace(/-(\w)/g,(function(e,t){return t?t.toUpperCase():""}))};function v(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}}var h="function"===typeof Object.freeze;function y(e){return h&&s(e)?Object.freeze(e):e}function m(e){return void 0===e&&(e=""),e?e.split(" ").reduce((function(e,t){var n;return t?Object.assign({},e,(n={},n[t]=1,n)):e}),{}):""}function b(e){return void 0===e&&(e={}),Object.keys(e).reduce((function(t,n){return e[n]?Object.assign({},t,m(n)):t}),{})}function g(e){void 0===e&&(e=[]);for(var t={},n=0,r=e.length;n<r;n++){var a=e[n];a&&(t=Object.assign({},t,"string"===typeof a?m(a):Array.isArray(a)?g(a):b(a)))}return t}function _(e,t){return void 0===e&&(e=""),void 0===t&&(t={}),Object.keys(g([e,t])).join(" ")}var C=l((function(e){var t={},n=/;(?![^(]*\))/g,r=/:(.+)/;return e.split(n).forEach((function(e){if(e){var n=e.split(r);n.length>1&&(t[n[0].trim()]=n[1].trim())}})),t}));function w(e){return Array.isArray(e)?a(e):"string"===typeof e?C(e):e}function A(e,t,n){return void 0===n&&(n=!0),t=w(t),n||(t.display="none"),e?r(e,t):t}var x=l((function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=n+1;return t}));function j(e){if(!isNaN(e)){var t=+e;e=x(t)}return e}function O(e,n){if("component"!==e.tagName||null==e.hotspot.props.is)return this.components[e.tagName];var r=e.props[e.hotspot.props.is],a=t.evalExpr(r.expr,n);return this.components[a]}function k(e){return e.reduce((function(e,t){var n=t.k,r=t.v;return e[n]=r,e}),{})}function T(e){var n=this;function r(e){for(var t=0,n=e.length;t<n;t++){var r=a(e[t]);if(r)return r}}function a(i){var o=i.nodeType;if(1!==o){var s;if(i.owner===n){var c,u;switch(o){case 4:case 3:if(c=i.aNode.directives.ref,u=c&&t.evalExpr(c.value,i.scope,n),c&&(u===e||d(u)===e))return 4===o?i.el:i.children.map(a);break;case 5:if(c=i.source.directives.ref,u=c&&t.evalExpr(c.value,i.scope,n),c&&(u===e||d(u)===e))return i}s=i.slotChildren&&r(i.slotChildren)}return s||r(i.children)}}return r(this.children)}var E={beforeCreate:"compiled",mounted:"attached",created:"inited",beforeMount:"created",beforeDestroy:"detached",destroy:"disposed",updated:"updated",beforeUpdate:"beforeUpdate",activated:"activated",deactivated:"deactivated"},$=Object.keys(E),K=["floor","ceil","round","abs","max","min","pow"],N={};K.forEach((function(e){N["math_"+e]=function(){var t=[],n=arguments.length;while(n--)t[n]=arguments[n];return Math[e].apply(Math,t)}})),N.array_slice=function(e,t,n){var r=null==n?void 0:n>=0?t+n:e.length+n;return e.slice(t,r)},N.array_join=function(e,t){return e.join(t)},N.str_pos=function(e,t){return e.indexOf(t)},N.object_freeze=function(e){return Object.freeze(e)};var L={json:function(e){return JSON.stringify(json)},lower:function(e){return e.toLowerCase()},upper:function(e){return e.toUpperCase()},_cat:function(e,t){return(e||"").toString()+(t||"")}},S=Object.freeze({__proto__:null,methods:N,filters:L}),D=["filters","computed"];function M(e,t){return t?e?e.concat(t):Array.isArray(t)?t:[t]:e}function P(e){for(var t={},n=Array.isArray(e.mixins)?[S].concat(e.mixins,[e]):[S,e],a={},i=0,o=n.length;i<o;i++){var s=n[i];s.methods&&r(a,s.methods);for(var c=0;c<D.length;c++){var u=D[c];s[u]&&(t[u]=r(t[u]||{},s[u]))}for(var l=0;l<$.length;l++){var f=$[l],p=E[f];s[f]&&(t[p]=M(t[p]||[],s[f]))}}for(var d=0;d<$.length;d++){var v=$[d],h=E[v];if(t[h]){var y=t[h].slice();t[h]=1===y.length?y[0]:function(){var e=this;y.forEach((function(t){return t.call(e)}),this)}}}return t._methodKeys=Object.keys(a),r(t,a),e.messages&&(t.messages=e.messages),t}var U=Array.prototype,z=["push","pop","shift","unshift","splice"],R="__proxy__";function q(e,n,a){var i=new I,o=Array.isArray(e);function s(e){var a=n&&n.paths||[];return r({},n,{paths:a.concat([{type:t.ExprType.STRING,value:e}])})}var c={set:function(e,t,n){if(e[t]===n)return!0;var r=s(t);return e[t]=W(n),a.data.fire({type:1,expr:r,value:e[t],option:{}}),!0},get:function(e,t){if(t===R)return!0;var r=s(t);if(i.depend({context:a,expr:r}),o&&z.indexOf(t)>=0){var c=U[t];return function(){var i=[],o=arguments.length;while(o--)i[o]=arguments[o];var s,u=[];switch(t){case"push":case"unshift":i[0]=W(i[0],r,a),u=[i[0]];break;case"splice":u=i.slice(2).map((function(e){return W(e,r,a)})),i=i.slice(0,2).concat(u);break}switch(t){case"push":case"pop":s=Math.max(e.length-1,0);break;case"shift":case"unshift":s=0;break;case"splice":s=i[0];var l=e.length;s>l?s=l:s<0&&(s=l+s,s<0&&(s=0));break}var f=c.apply(e,i);return a.data.fire({expr:n,type:2,index:s,deleteCount:f.length,value:f,insertions:u,option:{}}),f}}return W(e[t],r,a)}};return new Proxy(e,c)}var F={type:t.ExprType.ACCESSOR,paths:[]};function W(e,t,n){return s(e)?e[R]?e:(Array.isArray(e)||c(e))&&Object.isExtensible(e)?q(e,t,n):void 0:e}function G(){var e=this,t=r({},F),n=this._dataKeys.concat(this._propKeys),a=n.length;this.data.raw=W(this.data.raw,t,this);for(var i=this,o=function(t){var r=n[t];u(e,r,{get:function(){return i.data.raw[r]},set:function(e){i.data.raw[r]=e}})},s=0;s<a;s++)o(s);this.data.owner=this}function I(e,t){}function J(){I.target=[]}function V(){I.target=null}function Z(){var e=this,t=e.slotChildren,n=e.lifeCycle,a=e.sourceSlots;if(n.attached)return t.reduce((function(e,t){var n=t.name||"default";return e[n]||(e[n]=[]),e[n]=e[n].concat(t.children),e}),{});var i={};return a.named&&r(i,a.named),a.noname&&(i.default=a.noname),i}function B(e){var t=this.computedDeps[e];t||(t=this.computedDeps[e]={});var n=this;this.data.get(e);J();var r=this.computed[e].call(this),a=I.target;V(),console.log(e,a);for(var i=0;i<a.length;i++){var o=a[i],s=o.expr,c=o.context,u=this===c?"":"upper",l=s.paths.map((function(e){return e.value})).join("."),f=u+l;t[f]||(t[f]=1,delete s.changeCache,c.watch(s,(function(t){B.call(n,e)})))}this.data.raw[e]=r}function H(e){return function n(r){var a=this;a.nodeType===t.NodeType.CMPT&&a._toPhase(e),a.children&&a.children.length>1&&a.children.forEach(n)}}I.prototype.depend=function(e){I.target&&I.target.push(e)},I.target=null;var Q=H("activited"),X=H("deactivited"),Y=/\s+/;function ee(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split(Y).forEach((function(t){return e.classList.add(t)})):e.classList.add(t);else{var n=" "+(e.getAttribute("class")||"")+" ";n.indexOf(" "+t+" ")<0&&e.setAttribute("class",(n+t).trim())}}function te(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split(Y).forEach((function(t){return e.classList.remove(t)})):e.classList.remove(t),e.classList.length||e.removeAttribute("class");else{var n=" "+(e.getAttribute("class")||"")+" ",r=" "+t+" ";while(n.indexOf(r)>=0)n=n.replace(r," ");n=n.trim(),n?e.setAttribute("class",n):e.removeAttribute("class")}}function ne(e){if(e){if("object"===typeof e){var t={};return!1!==e.css&&r(t,re(e.name||"v")),r(t,e),t}return"string"===typeof e?re(e):void 0}}var re=l((function(e){return{enterClass:e+"-enter",enterToClass:e+"-enter-to",enterActiveClass:e+"-enter-active",leaveClass:e+"-leave",leaveToClass:e+"-leave-to",leaveActiveClass:e+"-leave-active"}})),ae="transition",ie="animation",oe="transition",se="transitionend",ce="animation",ue="animationend";void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(oe="WebkitTransition",se="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(ce="WebkitAnimation",ue="webkitAnimationEnd");var le=window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout;function fe(e){le((function(){le(e)}))}var pe=/\b(transform|all)(,|$)/;function de(e,t){var n,r=window.getComputedStyle(e),a=(r[oe+"Delay"]||"").split(", "),i=(r[oe+"Duration"]||"").split(", "),o=ve(a,i),s=(r[ce+"Delay"]||"").split(", "),c=(r[ce+"Duration"]||"").split(", "),u=ve(s,c),l=0,f=0;t===ae?o>0&&(n=ae,l=o,f=i.length):t===ie?u>0&&(n=ie,l=u,f=c.length):(l=Math.max(o,u),n=l>0?o>u?ae:ie:null,f=n?n===ae?i.length:c.length:0);var p=n===ae&&pe.test(r[oe+"Property"]);return{type:n,timeout:l,propCount:f,hasTransform:p}}function ve(e,t){while(e.length<t.length)e=e.concat(e);return Math.max.apply(null,t.map((function(t,n){return he(t)+he(e[n])})))}function he(e){return 1e3*Number(e.slice(0,-1).replace(",","."))}function ye(e,t){var n=e._transitionClasses||(e._transitionClasses=[]);n.indexOf(t)<0&&(n.push(t),ee(e,t))}function me(e,t){e._transitionClasses&&i(e._transitionClasses,t),te(e,t)}function be(e){return"number"===typeof e&&!isNaN(e)}function ge(e,t,n){var r=de(e,t),a=r.type,i=r.timeout,o=r.propCount;if(!a)return n();var s=a===ae?se:ue,c=0,u=function(){e.removeEventListener(s,l),n()},l=function(t){t.target===e&&++c>=o&&u()};setTimeout((function(){c<o&&u()}),i+1),e.addEventListener(s,l)}function _e(e){ne(e);var t=ne(e),n=t.css,r=t.type,a=t.enterClass,i=t.enterToClass,o=t.enterActiveClass,c=t.appearClass,u=t.appearToClass,l=t.appearActiveClass,f=t.beforeEnter,p=t.enter,d=t.afterEnter,h=t.enterCancelled,y=t.beforeAppear,m=t.appear,b=t.afterAppear,g=t.appearCancelled,_=t.leaveClass,C=t.leaveToClass,w=t.leaveActiveClass,A=t.beforeLeave,x=t.leave,j=t.afterLeave,O=t.leaveCancelled,k=t.delayLeave,T=t.duration,E=this,$=!1!==n;return{enter:N,leave:L};function K(e){if(!e)return!1;if("function"===typeof e)return e;var t=E.owner[e];return!(!t||"function"!==typeof t)&&t}function N(e,t){var n=!E.lifeCycle.attached;if(e._leaveCb&&(e._leaveCb.cancelled=!0,e._leaveCb()),!e._enterCb&&1===e.nodeType&&(!n||m)){var _=n&&c?c:a,C=n&&l?l:o,w=n&&u?u:i,A=n&&K(y)||K(f),x=n&&K(m)||K(p),j=n&&K(b)||K(d),O=n&&K(g)||K(h),k=+(s(T)?T.enter:T),N=x&&x.length>1,L=e._enterCb=v((function(){$&&(me(e,w),me(e,C)),L.cancelled?($&&me(e,_),O&&O(e)):j&&j(e),e._enterCb=null}));x&&x(e,L),A&&A(e),$&&(ye(e,_),ye(e,C),fe((function(){me(e,_),L.cancelled||(ye(e,w),N||(be(k)?setTimeout(L,k):ge(e,r,L)))}))),$||N||L(),t()}}function L(e,t){if(e._enterCb&&(e._enterCb.cancelled=!0,e._enterCb()),!e._leaveCb){var n=K(x),a=K(k),i=K(A),o=K(j),c=+(s(T)?T.leave:T),u=n&&n.length>1,l=e._leaveCb=v((function(){$&&(me(e,C),me(e,w)),l.cancelled?($&&me(e,_),O&&O(e)):(t(),o&&o(e)),e._leaveCb=null}));a?a(f):f()}function f(){l.cancelled||(i&&i(e),$&&(ye(e,_),ye(e,w),fe((function(){me(e,_),l.cancelled||(ye(e,C),u||(be(c)?setTimeout(l,c):ge(e,r,l)))}))),n&&n(e,l),$||u||l())}}}var Ce=function(){},we={$activate:Q,$deactivate:X,_mc:_,_ms:A,_l:j,_ex:r,_ocp:k,_noop:Ce,_t:_e,getComponentType:O,$emit:t.Component.prototype.fire,$on:t.Component.prototype.on,$watch:t.Component.prototype.watch,$nextTick:t.nextTick},Ae={$el:function(){return this.el},$context:function(){return this.owner},$parent:function(){return this.parentComponent},$children:function(){return this.children.filter((function(e){return 5===e.nodeType}))},$root:function(){var e=this;if(this.parentComponent)while(e.parentComponent)e=e.parentComponent;return e},$slots:Z,_isDestroyed:function(){return!!this.lifeCycle.disposed}},xe=t.Component.prototype._update;t.Component.prototype._update=function(e){e&&this._toPhase("beforeUpdate"),xe.call(this,e)};var je="_SanCtor";function Oe(e){if(e[je])return e[je];var n=r({template:e.__santemplate,aNode:e.__sanaNode,_isSan:!0},we,P(e)),a=n.compiled;n.compiled=function(){this._calcComputed=Ce,a&&a.call(this);var t=Object.keys(Ae).reduce((function(e,t){return e[t]={get:function(){return Ae[t].call(this)}},e}),{});t.$options={value:e},Object.defineProperties(this,t)};var i=e.__sanRefs,o=n.inited;n.inited=function(){var t=this,n=this;if(this.$refs=Object.create(null),i){for(var a=function(e,t){var r=i[e];u(n.$refs,r.name,{get:function(){return r.root?n.el:n.ref(r.name)}})},s=0,c=i.length;s<c;s++)a(s,c);n.ref=T}this.$style&&r(this.data.raw.$style,y(this.$style));for(var l=function(e){var r=t._computedKeys[e];t.data.raw[r]=null,u(t,r,{get:function(){return n.data.raw[r]}})},f=0;f<t._computedKeys.length;f++)l(f);G.call(this);for(var p=0;p<this._computedKeys.length;p++){var d=this._computedKeys[p];B.call(this,d)}for(var v=0;v<this._methodKeys.length;v++){var h=this._methodKeys[v];this[h]=this[h].bind(this)}o&&o.call(this),e.watch&&Object.keys(e.watch).forEach((function(n){t.watch(n,e.watch[n].bind(t))})),e.preprocessANode&&e.preprocessANode.call(this)};var s=n.beforeUpdate;n.beforeUpdate=function(){s&&s.call(this),e.preprocessANode&&e.preprocessANode.call(this)},n.initData=function(){var t=this,n={};if(e.props){var a=t._propKeys=e._propKeys=e.props?Array.isArray(e.props)?e.props:Object.keys(e.props):[];if(!Array.isArray(e.props))for(var i=0,o=a.length;i<o;i++){var s=a[i],c=e.props[s];"default"in c&&(n[s]="function"===typeof c.default?c.default():c.default)}}else t._propKeys=[];e.computed?t._computedKeys=Object.keys(e.computed):t._computedKeys=[];var u="function"===typeof e.data?e.data.call(r({},n,this._srcSbindData)):e.data||{};return this._dataKeys=Object.keys(u)||[],r({$style:{}},n,u)},e.components&&(n.components=Object.keys(e.components).reduce((function(n,r){var a=e.components[r];return n[r]=n[p(r)]=a instanceof t.Component?a:a.template||a.aNode?t.defineComponent(a):Oe(a),n}),{}),n._cmptReady=1);var c=t.defineComponent(n);return e[je]=c}e.defineComponent=Oe,Object.defineProperty(e,"__esModule",{value:!0})}));
